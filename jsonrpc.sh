#!/bin/bash

export PANTHEON_HOME=/Users/dannoferrin/git/github.com/shemnon/pantheon/build/install/pantheon
export RPC_PORT=18545
export TMP_DATA_DIR=/tmp/PAN3027

rm -rf $TMP_DATA_DIR
mkdir $TMP_DATA_DIR
$PANTHEON_HOME/bin/pantheon --network=dev --p2p-enabled=false --miner-enabled --miner-coinbase=f17f52151EbEF6C7334FAD080c5704D77216b732 --data-path=$TMP_DATA_DIR --rpc-http-enabled --rpc-http-port=$RPC_PORT > $TMP_DATA_DIR/log &

echo
read -p "Press [Enter] key to deploy SimpleStorage ..."

# create contract
curl -X POST --data '{"jsonrpc":"2.0","method":"eth_sendRawTransaction","params":["0xf907068085051f4d5c0083419ce08080b906b3608060405234801561001057600080fd5b50610693806100206000396000f3fe608060405234801561001057600080fd5b50600436106100b0576000357c0100000000000000000000000000000000000000000000000000000000900480639ccc3555116100835780639ccc355514610120578063c629841914610128578063c9b02cb014610149578063de7b5d1414610151578063f71f7a2514610181576100b0565b80631f11d375146100b55780632a1afcd9146100da57806338cc4831146100f45780633dc2692814610118575b600080fd5b6100d8600480360360408110156100cb57600080fd5b50803590602001356101a4565b005b6100e261022f565b60408051918252519081900360200190f35b6100fc610235565b60408051600160a060020a039092168252519081900360200190f35b6100e2610244565b6100d861024a565b6101306102a5565b6040805192835260208301919091528051918290030190f35b6100fc6102af565b6101596102be565b60408051600160a060020a039094168452602084019290925282820152519081900360600190f35b6100d86004803603604081101561019757600080fd5b50803590602001356103e5565b600254604080517ff71f7a2500000000000000000000000000000000000000000000000000000000815260048101859052602481018490529051600160a060020a0390921691829163f71f7a2591604480830192600092919082900301818387803b15801561021257600080fd5b505af1158015610226573d6000803e3d6000fd5b50505050505050565b60005481565b600254600160a060020a031690565b60015481565b600060405161025890610456565b604051809103906000f080158015610274573d6000803e3d6000fd5b506002805473ffffffffffffffffffffffffffffffffffffffff1916600160a060020a039290921691909117905550565b6000546001549091565b600254600160a060020a031681565b600254604080517f2a1afcd9000000000000000000000000000000000000000000000000000000008152905160009283928392600160a060020a039092169182918291632a1afcd991600480820192602092909190829003018186803b15801561032757600080fd5b505afa15801561033b573d6000803e3d6000fd5b505050506040513d602081101561035157600080fd5b5051604080517f3dc269280000000000000000000000000000000000000000000000000000000081529051600160a060020a03851691633dc26928916004808301926020929190829003018186803b1580156103ac57600080fd5b505afa1580156103c0573d6000803e3d6000fd5b505050506040513d60208110156103d657600080fd5b50519195509350915050909192565b60408051602081018490528181526003818301527f7365740000000000000000000000000000000000000000000000000000000000606082015290517fe121790169417ea9f1a739d30cd01714ee1e12121f56fa0232fd0a9c62745e8f9181900360800190a1600091909155600155565b6101d6806104648339019056fe608060405234801561001057600080fd5b506101b6806100206000396000f3fe608060405234801561001057600080fd5b5060043610610068577c010000000000000000000000000000000000000000000000000000000060003504632a1afcd9811461006d5780633dc26928146100875780636d4ce63c1461008f578063f71f7a25146100b0575b600080fd5b6100756100d5565b60408051918252519081900360200190f35b6100756100db565b6100976100e1565b6040805192835260208301919091528051918290030190f35b6100d3600480360360408110156100c657600080fd5b50803590602001356100eb565b005b60005481565b60015481565b6000546001549091565b60408051602081018490528181526003818301527f7365740000000000000000000000000000000000000000000000000000000000606082015290517fe121790169417ea9f1a739d30cd01714ee1e12121f56fa0232fd0a9c62745e8f9181900360800190a160009190915560015556fea265627a7a7231582027072df4c3510aad5efea4fc54f5c2c74f85786f0b2aed42b8e4c89ed3b2803564736f6c637827302e352e31312d646576656c6f702e323031392e372e312b636f6d6d69742e37646531386233370057a265627a7a723158203ac5f8c0a62c148a39a2e8913c546f44b26670a409aa056070c31f6d885fd22c64736f6c637827302e352e31312d646576656c6f702e323031392e372e312b636f6d6d69742e376465313862333700571ca0529dac72510d7d90d70e617f17297b374e54da571f69aedc1f1a71e0be4116d8a017ad803a0246a86dffdfd70b77d15cc53fa96a17d0d1bfc1a97c8f127aba47d6"],"id":2}' http://127.0.0.1:$RPC_PORT

echo
read -p "Press [Enter] key to call SimpleStorage.setContract ..."

# SimpleContract.setContract
curl -X POST --data '{"jsonrpc":"2.0","method":"eth_sendRawTransaction","params":["0xf8690185051f4d5c0083419ce09442699a7612a82f1d9c36148af9c77354759b210b80849ccc35551ba02400b825f0d73daf7bd3e5c526f67090a30774e47e805f382c03283810196e10a078dd51bf1268e87c0e57e5128778c84477634a77abc5b7a3611ce75105a7b823"],"id":6}' http://127.0.0.1:$RPC_PORT

echo
read -p "Press [Enter] key to call SimpleStorage.getAddress ..."

# SimpleStorage.getAddress
curl -X POST --data '{"jsonrpc":"2.0","method":"eth_call","params":[{"from":"0xfe3b557e8fb62b89f4916b721be55ceb828dbd73","to":"0x42699a7612a82f1d9c36148af9c77354759b210b","data":"0x38cc4831"},"latest"],"id":9}' http://127.0.0.1:$RPC_PORT

echo
echo expecting "0x0000000000000000000000002f632b08ece7e9dca0fcff1f91c1d5bc245440eb"

read -p "Press [Enter] key to call SimpleStorage2.set ..."

#SimpleStorage2.set
curl -X POST --data '{"jsonrpc":"2.0","method":"eth_sendRawTransaction","params":["0xf8aa0285051f4d5c0083419ce0942f632b08ece7e9dca0fcff1f91c1d5bc245440eb80b844f71f7a25010101010101010101010101010101010101010101010101010101010101010102020202020202020202020202020202020202020202020202020202020202021ca01e4e61cd3d583e8d16a49111e041e5585d9a03b9cc75c1ca60f12cee5b30a3f6a04006493656b12ceacb05113f8ff758836ab52bc1b5365e391534473fa93e6c65"],"id":11}' http://127.0.0.1:$RPC_PORT

echo
read -p "Press [Enter] key to call SimpleStorage2.get ..."

curl -X POST --data '{"jsonrpc":"2.0","method":"eth_call","params":[{"from":"0xfe3b557e8fb62b89f4916b721be55ceb828dbd73","to":"0x2f632b08ece7e9dca0fcff1f91c1d5bc245440eb","data":"0x6d4ce63c"},"latest"],"id":14}' http://127.0.0.1:$RPC_PORT

read -p "Press [Enter] key to shutdown ..."
kill %1

